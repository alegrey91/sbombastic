---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.16.5
  name: vulnerabilityreports.storage.sbombastic.rancher.io
spec:
  group: storage.sbombastic.rancher.io
  names:
    kind: VulnerabilityReport
    listKind: VulnerabilityReportList
    plural: vulnerabilityreports
    singular: vulnerabilityreport
  scope: Namespaced
  versions:
  - name: v1alpha1
    schema:
      openAPIV3Schema:
        description: VulnerabilityReport is the Schema for the scanresults API
        properties:
          apiVersion:
            description: |-
              APIVersion defines the versioned schema of this representation of an object.
              Servers should convert recognized schemas to the latest internal value, and
              may reject unrecognized values.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources
            type: string
          kind:
            description: |-
              Kind is a string value representing the REST resource this object represents.
              Servers may infer this from the endpoint the client submits requests to.
              Cannot be updated.
              In CamelCase.
              More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds
            type: string
          metadata:
            type: object
          spec:
            description: VulnerabilityReportSpec defines the desired state of a VulnerabilityReport
            properties:
              imageMetadata:
                description: ImageMetadata contains info about the scanned image
                properties:
                  digest:
                    description: Digest specifies the sha256 digest of the image.
                    type: string
                  platform:
                    description: Platform specifies the platform of the image. Example
                      "linux/amd64".
                    type: string
                  registry:
                    description: Registry specifies the name of the Registry object
                      in the same namespace where the image is stored.
                    type: string
                  registryURI:
                    description: 'RegistryURI specifies the URI of the registry where
                      the image is stored. Example: "registry-1.docker.io:5000".`'
                    type: string
                  repository:
                    description: 'Repository specifies the repository path of the
                      image. Example: "rancher/sbombastic".'
                    type: string
                  tag:
                    description: 'Tag specifies the tag of the image. Example: "latest".'
                    type: string
                required:
                - digest
                - platform
                - registry
                - registryURI
                - repository
                - tag
                type: object
              report:
                description: Report is the actual vulnerability scan report
                properties:
                  results:
                    description: Results per target (e.g., layer, package type)
                    items:
                      description: Result represents scan findings for a specific
                        target and class of packages
                      properties:
                        class:
                          description: Class is the classification of the target
                          type: string
                        target:
                          description: Target is the specific target scanned
                          type: string
                        type:
                          description: Type is the language type
                          type: string
                        vulnerabilities:
                          description: Vulnerabilities found in this target
                          items:
                            description: |-
                              Vulnerability contains detailed information about a single vulnerability
                              found in a package
                            properties:
                              cve:
                                description: CVE identifier
                                type: string
                              cvss:
                                additionalProperties:
                                  description: CVSS holds Common Vulnerability Scoring
                                    System data for a vulnerability.
                                  properties:
                                    v3score:
                                      description: V3Score numerical score
                                      type: string
                                    v3vector:
                                      description: V3Vector string (e.g., "AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H")
                                      type: string
                                  required:
                                  - v3score
                                  - v3vector
                                  type: object
                                description: CVSS scoring details
                                type: object
                              description:
                                description: Description of the vulnerability
                                type: string
                              diffID:
                                description: DiffID of the image layer where the vulnerability
                                  was introduced
                                type: string
                              fixedVersions:
                                description: FixedVersions is the list of versions
                                  where the vulnerability is fixed
                                items:
                                  type: string
                                type: array
                              installedVersion:
                                description: InstalledVersion of the package that
                                  was found
                                type: string
                              packageName:
                                description: |-
                                  PackageName is the name of the vulnerable package
                                  (empty when Class is "binary")
                                type: string
                              packagePath:
                                description: |-
                                  PackagePath is the path where the package was found
                                  (equal to Target when Class is "binary").
                                  trivy removes the "/" at the beginning of the path
                                  so we have to restore it.
                                type: string
                              purl:
                                description: PURL (Package URL) identify the package
                                  uniquely
                                type: string
                              references:
                                description: References contains URLs for more information
                                items:
                                  type: string
                                type: array
                              severity:
                                description: Severity rating (e.g., "HIGH", "MEDIUM")
                                type: string
                              suppressed:
                                description: |-
                                  Suppressed identify when vulnerability has
                                  been suppressed by VEX documents
                                type: boolean
                              title:
                                description: Title is the title of the vulnerability
                                type: string
                              vexStatus:
                                description: VEXStatus information
                                properties:
                                  repository:
                                    description: Repository providing the VEX document
                                    type: string
                                  statement:
                                    description: Statement optionally explain statement
                                      from the VEX document
                                    type: string
                                  status:
                                    description: VEX status (e.g., "not_affected",
                                      "fixed", "under_investigation")
                                    type: string
                                required:
                                - repository
                                - statement
                                - status
                                type: object
                            required:
                            - cve
                            - diffID
                            - installedVersion
                            - purl
                            - severity
                            - suppressed
                            type: object
                          type: array
                      required:
                      - class
                      - target
                      - type
                      - vulnerabilities
                      type: object
                    type: array
                required:
                - results
                type: object
            required:
            - imageMetadata
            - report
            type: object
          status:
            description: VulnerabilityReportStatus defines the observed state of ScanResult
            type: object
        type: object
    selectableFields:
    - jsonPath: .spec.imageMetadata.registry
    - jsonPath: .spec.imageMetadata.registryURI
    - jsonPath: .spec.imageMetadata.repository
    - jsonPath: .spec.imageMetadata.tag
    - jsonPath: .spec.imageMetadata.platform
    - jsonPath: .spec.imageMetadata.digest
    served: true
    storage: true
