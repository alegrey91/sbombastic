# Scanning Registries

This guide explains how to configure and run scans on container registries using SBOMbastic.

It covers:

- Defining a `Registry` custom resource
- Running on-demand scans with a `ScanJob`
- Configuring scheduled scans
- Configuring registry without catalog
- Monitoring scan progress and results
- Stopping scans and cleaning up resources
- Remove a Registry

## 1. Define a Registry

Before scanning a registry, create a `Registry` custom resource that specifies the registry endpoint and repositories to scan.

Example manifest:

```yaml
apiVersion: sbombastic.rancher.io/v1alpha1
kind: Registry
metadata:
  name: my-registry
  namespace: default
spec:
  uri: ghcr.io
  scanInterval: 1h
  repositories:
    - rancher-sandbox/sbombastic/test-assets/golang
```

This configuration:

- Targets the `ghcr.io` registry
- Scans the `rancher-sandbox/sbombastic/test-assets/golang` repository
- Runs a new scan every hour

Apply the resource:

```bash
kubectl apply -f registry.yaml
```

For private registries, see the [Private Registries guide](./private-registries.md).

## 2. Run a Scan on Demand

To run a one-time scan, omit the `scanInterval` in the `Registry` resource and create a `ScanJob` that references it.

Example `Registry` without scheduling:

```yaml
apiVersion: sbombastic.rancher.io/v1alpha1
kind: Registry
metadata:
  name: my-registry
  namespace: default
spec:
  uri: ghcr.io
  repositories:
    - rancher-sandbox/sbombastic/test-assets/golang
```

Example `ScanJob` manifest:

```yaml
apiVersion: sbombastic.rancher.io/v1alpha1
kind: ScanJob
metadata:
  name: my-scanjob
  namespace: default
spec:
  registry: my-registry
```

Apply the job:

```bash
kubectl apply -f scanjob.yaml
```

> **Note**: The `ScanJob` must be created in the same namespace as its referenced `Registry`.

## 3. Configuring registry without catalog

In some cases, you may work with registries that do not implement/exposes the `_catalog` endpoint (such as **Docker Hub**, **Amazon ECR**, or **ghcr.io**).

To make SBOMbastic work with these registries, you can manually specify the repositories you want to scan, instead of pulling the catalog.

> **Note**: When using `catalogType` as `NoCatalog`, you must explicitly provide the list of `repositories` to scan.

Example `Registry` without catalog:

```yaml
apiVersion: sbombastic.rancher.io/v1alpha1
kind: Registry
metadata:
  name: my-registry
  namespace: default
spec:
  uri: ghcr.io
  catalogType: NoCatalog
  repositories:
    - rancher-sandbox/sbombastic/test-assets/golang
```

Here's a list of registries that do NOT support `_catalog` (or intentionally disable it):

* Amazon ECR

* Google Container Registry (GCR)

* GitHub Container Registry (GHCR)

## 4. Monitor Scan Progress

Check the status of a scan:

```bash
kubectl get scanjob my-scanjob -n default -o yaml
```

Example status:

```yaml
status:
  imagesCount: 10
  conditions:
    - type: Complete
      status: "True"
      reason: "AllImagesScanned"
      message: "Scan completed successfully"
```

## 5. View Results

Reports generated by scans include images, SBOMs, and vulnerability findings.
See the [Querying Reports guide](./querying-reports.md) for details.

## 6. Stop an Ongoing Scan

To cancel a running scan, delete its `ScanJob`:

```bash
kubectl delete scanjob my-scanjob -n default
```

## 7. Remove a Registry

To delete a registry and its associated data:

```bash
kubectl delete registry my-registry -n default
```

This action removes:

- The registry definition
- All related images, SBOMs, and vulnerability reports
- Any `ScanJob` resources referencing the registry

If a scan is in progress, it will be terminated.
